#!/bin/bash

# LinSecure.sh - A script to harden the security of a Linux system
# by disabling unnecessary services and protocols, enabling security features,
# and asking the user for confirmation before making any changes.

echo "Disable SMBv1?"
read -p "(Y/N) " input
if [[ $input =~ ^[Yy]$ ]]; then
  sudo apt-get remove --purge samba-common-bin
  sudo apt-get autoremove
fi

echo "Disable Remote Registry Service?"
read -p "(Y/N) " input
if [[ $input =~ ^[Yy]$ ]]; then
  sudo service rpcbind stop
  sudo update-rc.d rpcbind disable
fi

echo "Disable LLMNR?"
read -p "(Y/N) " input
if [[ $input =~ ^[Yy]$ ]]; then
  sudo echo "net.ipv6.conf.all.disable_ipv6 = 1" | sudo tee -a /etc/sysctl.conf
  sudo sysctl -p
fi

echo "Disable NetBIOS over TCP/IP?"
read -p "(Y/N) " input
if [[ $input =~ ^[Yy]$ ]]; then
  sudo apt-get install iptables-persistent
  sudo iptables -A INPUT -p tcp --dport 137 -j DROP
  sudo iptables -A INPUT -p udp --dport 137 -j DROP
  sudo netfilter-persistent save
fi

echo "Enable Control Flow Guard (CFG)?"
read -p "(Y/N) " input
if [[ $input =~ ^[Yy]$ ]]; then
  sudo apt-get install execstack
  sudo execstack -c /usr/bin/program_name
fi

echo "Done!"
