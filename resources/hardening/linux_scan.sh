#!/bin/bash

# Check if root
if [ $(id -u) -ne 0 ]; then
    echo "Script must be run as root"
    exit 1
fi

# Check if package lists have been updated in the last 48 hours
if [ ! -e /var/lib/apt/periodic/update-success-stamp ] || [ $(find /var/lib/apt/periodic/update-success-stamp -mtime +1) ]; then
    echo "Updating package lists..."
    sudo apt update
else
    echo "Package lists already up to date"
fi

# Install required packages if not already installed
required_packages=(rkhunter clamav lynis chkrootkit)
for package in "${required_packages[@]}"; do
    if ! command -v "$package" &> /dev/null; then
        echo "$package not found, installing..."
        sudo apt install -y "$package"
    else
        echo "$package already installed"
    fi
done

# Run system scans and save output to a file
echo "Running system scans..."
sudo rkhunter --update
sudo rkhunter --propupd
sudo rkhunter --check >> ~/system_scan.txt
sudo clamscan -r / >> ~/system_scan.txt
sudo lynis audit system >> ~/system_scan.txt
sudo chkrootkit >> ~/system_scan.txt

echo "System scans completed. Results saved to ~/system_scan.txt"
