metadata:
  language: v1-beta
  name: "InsecureDeserialization-check"
  description: "Checks for potential Insecure Deserialization vulnerabilities"
  author: "SecGPT"

run for each:
  potential_payload = '{"__proto__":{"test":true}}'

given request then
  send request called check:
    method: {request.method}
    path: {request.path}
    parameters: {request.parameters.replace("PLACEHOLDER", potential_payload)}
    body: {request.body}

  if "test" in {check.response.body} then
    report issue:
      name: "Potential Insecure Deserialization vulnerability detected"
      severity: high
      confidence: certain
      description: "The application may be vulnerable to Insecure Deserialization. The payload `{potential_payload}` was reflected in the HTTP response."
      remediation: "Implement proper input validation and secure serialization methods to prevent Insecure Deserialization attacks."
      evidence: {check.response.body}
