metadata:
  language: v1-beta
  name: "XSSI-check"
  description: "Checks for potential XSSI vulnerabilities"
  author: "SecGPT"

given request then
  send request called check:
    method: {request.method}
    path: {request.path}
    parameters: {request.parameters}
    body: {request.body}

  if "content-type: application/javascript" in {check.response.headers} and ("callback(" in {check.response.body} or "jsonp(" in {check.response.body}) then
    report issue:
      name: "Potential XSSI vulnerability detected"
      severity: high
      confidence: certain
      description: "The application may be vulnerable to Cross-Site Script Inclusion (XSSI). The response body contains a callback or jsonp function."
      remediation: "Implement proper output encoding and input validation to prevent XSSI attacks."
      evidence: {check.response.body}
						