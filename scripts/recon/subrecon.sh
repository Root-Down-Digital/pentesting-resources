#!/bin/bash
# subdomain recon script
# Usage: ./subrecon.sh domain.com

# Declare your target domain
domain=$1

# Check if domain is passed as an argument
if [ -z "$domain" ]
then
  echo "Usage: ./subdomain_recon.sh domain.com"
  exit 1
fi

# Use subfinder to find subdomains
echo "[*] Running subfinder..."
subfinder -d $domain -silent > subdomains.txt

# Use alterx to generate permutations of these subdomains
echo "[*] Running alterx..."
cat subdomains.txt | alterx > altered_subdomains.txt

# Use altdns to generate additional permutations
echo "[*] Running altdns..."
altdns -i altered_subdomains.txt -o data_output -w words.txt -r -S

# Use assetfinder and hakcheckurl to validate these subdomains
echo "[*] Running assetfinder and hakcheckurl..."
cat data_output | assetfinder -subs-only | hakcheckurl | grep -v 404 > valid_subdomains.txt

# Use Amass to gather additional intel
echo "[*] Running Amass..."
amass enum -passive -d $domain >> valid_subdomains.txt

# Use gobuster on the identified subdomains
echo "[*] Running Gobuster..."
while read subdomain; do
  gobuster dir -u $subdomain -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,php -o "$subdomain.txt"
done < valid_subdomains.txt

# Clean up
rm subdomains.txt altered_subdomains.txt data_output
